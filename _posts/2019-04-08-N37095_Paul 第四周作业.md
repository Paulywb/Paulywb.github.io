# 1、描述GPT是什么，应该怎么使用



# 2、创建一个10G的分区，并格式化为ext4文件系统。要求：

## (1) block大小为2048，预留空间20%，卷标为MYDATA；

## (2) 挂载至/mydata目录，要求挂载时禁止程序自动运行，且不更新文件的访问时间戳；

## (3) 可开机自动挂载。

**步骤1：创建一个10G分区：`/dev/sda5`**

> ```
> [root@localhost ~]# fdisk /dev/sda
> 
> WARNING: DOS-compatible mode is deprecated. It's strongly recommended to
>          switch off the mode (command 'c') and change display units to
>          sectors (command 'u').
> 
> Command (m for help): p
> 
> Disk /dev/sda: 128.8 GB, 128849018880 bytes
> 255 heads, 63 sectors/track, 15665 cylinders
> Units = cylinders of 16065 * 512 = 8225280 bytes
> Sector size (logical/physical): 512 bytes / 512 bytes
> I/O size (minimum/optimal): 512 bytes / 512 bytes
> Disk identifier: 0x0006b0aa
> 
>    Device Boot      Start         End      Blocks   Id  System
> /dev/sda1   *           1        7650    61440000   83  Linux
> /dev/sda2            7650        7905     2048000   82  Linux swap / Solaris
> /dev/sda3            7905        9210    10490301   83  Linux
> 
> Command (m for help): n
> Command action
>    e   extended
>    p   primary partition (1-4)
> e
> Selected partition 4
> First cylinder (9211-15665, default 9211): 
> Using default value 9211
> Last cylinder, +cylinders or +size{K,M,G} (9211-15665, default 15665): 
> Using default value 15665
> 
> Command (m for help): p
> 
> Disk /dev/sda: 128.8 GB, 128849018880 bytes
> 255 heads, 63 sectors/track, 15665 cylinders
> Units = cylinders of 16065 * 512 = 8225280 bytes
> Sector size (logical/physical): 512 bytes / 512 bytes
> I/O size (minimum/optimal): 512 bytes / 512 bytes
> Disk identifier: 0x0006b0aa
> 
>    Device Boot      Start         End      Blocks   Id  System
> /dev/sda1   *           1        7650    61440000   83  Linux
> /dev/sda2            7650        7905     2048000   82  Linux swap / Solaris
> /dev/sda3            7905        9210    10490301   83  Linux
> /dev/sda4            9211       15665    51849787+   5  Extended
> 
> Command (m for help): n
> First cylinder (9211-15665, default 9211): 
> Using default value 9211
> Last cylinder, +cylinders or +size{K,M,G} (9211-15665, default 15665): +10G
> 
> Command (m for help): p
> 
> Disk /dev/sda: 128.8 GB, 128849018880 bytes
> 255 heads, 63 sectors/track, 15665 cylinders
> Units = cylinders of 16065 * 512 = 8225280 bytes
> Sector size (logical/physical): 512 bytes / 512 bytes
> I/O size (minimum/optimal): 512 bytes / 512 bytes
> Disk identifier: 0x0006b0aa
> 
>    Device Boot      Start         End      Blocks   Id  System
> /dev/sda1   *           1        7650    61440000   83  Linux
> /dev/sda2            7650        7905     2048000   82  Linux swap / Solaris
> /dev/sda3            7905        9210    10490301   83  Linux
> /dev/sda4            9211       15665    51849787+   5  Extended
> /dev/sda5            9211       10516    10490413+  83  Linux
> 
> Command (m for help): w
> The partition table has been altered!
> 
> Calling ioctl() to re-read partition table.
> 
> WARNING: Re-reading the partition table failed with error 16: Device or resource busy.
> The kernel still uses the old table. The new table will be used at
> the next reboot or after you run partprobe(8) or kpartx(8)
> Syncing disks.
> [root@localhost ~]# cat /proc/partitions 
> major minor  #blocks  name
> 
>    8        0  125829120 sda
>    8        1   61440000 sda1
>    8        2    2048000 sda2
>    8        3   10490301 sda3
> [root@localhost ~]# partx -a /dev/sda
> BLKPG: Device or resource busy
> error adding partition 1
> BLKPG: Device or resource busy
> error adding partition 2
> BLKPG: Device or resource busy
> error adding partition 3
> [root@localhost ~]# partx -a /dev/sda
> BLKPG: Device or resource busy
> error adding partition 1
> BLKPG: Device or resource busy
> error adding partition 2
> BLKPG: Device or resource busy
> error adding partition 3
> BLKPG: Device or resource busy
> error adding partition 4
> BLKPG: Device or resource busy
> error adding partition 5
> [root@localhost ~]# cat /proc/partitions 
> major minor  #blocks  name
> 
>    8        0  125829120 sda
>    8        1   61440000 sda1
>    8        2    2048000 sda2
>    8        3   10490301 sda3
>    8        4         31 sda4
>    8        5   10490413 sda5
> [root@localhost ~]# 
> ```

**步骤2：格式化分区：**

```
[root@localhost ~]# mke2fs -t ext4 -b 2048 -m 20 -L "MYDATA" /dev/sda5
```

> ```
> [root@localhost ~]# mke2fs -t ext4 -b 2048 -m 20 -L "MYDATA" /dev/sda5
> mke2fs 1.41.12 (17-May-2010)
> Filesystem label=MYDATA
> OS type: Linux
> Block size=2048 (log=1)
> Fragment size=2048 (log=1)
> Stride=0 blocks, Stripe width=0 blocks
> 657408 inodes, 5245206 blocks
> 1049041 blocks (20.00%) reserved for the super user
> First data block=0
> Maximum filesystem blocks=543162368
> 321 block groups
> 16384 blocks per group, 16384 fragments per group
> 2048 inodes per group
> Superblock backups stored on blocks: 
> 	16384, 49152, 81920, 114688, 147456, 409600, 442368, 802816, 1327104, 
> 	2048000, 3981312
> 
> Writing inode tables: done                            
> Creating journal (32768 blocks): done
> Writing superblocks and filesystem accounting information: done
> 
> This filesystem will be automatically checked every 32 mounts or
> 180 days, whichever comes first.  Use tune2fs -c or -i to override.
> [root@localhost ~]#
> [root@localhost ~]# tune2fs -l /dev/sda5
> tune2fs 1.41.12 (17-May-2010)
> Filesystem volume name:   MYDATA
> Last mounted on:          <not available>
> Filesystem UUID:          446971c3-97f3-4f46-a9c0-b31e88f01763
> Filesystem magic number:  0xEF53
> Filesystem revision #:    1 (dynamic)
> Filesystem features:      has_journal ext_attr resize_inode dir_index filetype extent flex_bg sparse_super huge_file uninit_bg dir_nlink extra_isize
> Filesystem flags:         signed_directory_hash 
> Default mount options:    (none)
> Filesystem state:         clean
> Errors behavior:          Continue
> Filesystem OS type:       Linux
> Inode count:              657408
> Block count:              5245206
> Reserved block count:     1049041
> Free blocks:              5123382
> Free inodes:              657397
> First block:              0
> Block size:               2048
> Fragment size:            2048
> Reserved GDT blocks:      512
> Blocks per group:         16384
> Fragments per group:      16384
> Inodes per group:         2048
> Inode blocks per group:   256
> Flex block group size:    16
> Filesystem created:       Fri Apr 12 17:52:28 2019
> Last mount time:          n/a
> Last write time:          Fri Apr 12 17:52:35 2019
> Mount count:              0
> Maximum mount count:      32
> Last checked:             Fri Apr 12 17:52:28 2019
> Check interval:           15552000 (6 months)
> Next check after:         Wed Oct  9 17:52:28 2019
> Lifetime writes:          226 MB
> Reserved blocks uid:      0 (user root)
> Reserved blocks gid:      0 (group root)
> First inode:              11
> Inode size:	          256
> Required extra isize:     28
> Desired extra isize:      28
> Journal inode:            8
> Default directory hash:   half_md4
> Directory Hash Seed:      e9e8426a-be96-4af0-a624-25be5c497ffe
> Journal backup:           inode blocks
> [root@localhost ~]# 
> [root@localhost ~]# blkid /dev/sda5
> /dev/sda5: LABEL="MYDATA" UUID="446971c3-97f3-4f46-a9c0-b31e88f01763" TYPE="ext4" 
> [root@localhost ~]# 
> ```

**步骤3：编辑`/etc/fstab`文件：**

```
LABEL="MYDATA"          /mydata         ext4    defaults,noexec,noatime         0 0 
```

> ```
> [root@localhost ~]# ls /mydata
> ls: cannot access /mydata: No such file or directory
> [root@localhost ~]# mkdir /mydata
> [root@localhost ~]# ls /mydata
> [root@localhost ~]#
> [root@localhost ~]# vim /etc/fstab
> #
> # /etc/fstab
> # Created by anaconda on Tue Apr  9 05:47:56 2019
> #
> # Accessible filesystems, by reference, are maintained under '/dev/disk'
> # See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
> #
> UUID=04fe120c-e6ec-4c2e-a7a2-40f855eccfbb /                       ext4    defaults        1 1
> UUID=f384763f-8e6b-49a4-8830-c3503737433e swap                    swap    defaults        0 0
> tmpfs                   /dev/shm                tmpfs   defaults        0 0
> devpts                  /dev/pts                devpts  gid=5,mode=620  0 0
> sysfs                   /sys                    sysfs   defaults        0 0
> proc                    /proc                   proc    defaults        0 0
> 
> #mount /dev/sda5 /mydata
> LABEL="MYDATA"          /mydata         ext4    defaults,noexec,noatime         0 0  
> [root@localhost ~]# mount -a
> [root@localhost ~]# mount | grep "/mydata"
> /dev/sda5 on /mydata type ext4 (rw,noexec,noatime)
> [root@localhost ~]# ls /mydata/
> lost+found
> [root@localhost ~]# df -lh | grep "/mydata"
> /dev/sda5       9.8G   13M  7.8G   1% /mydata
> ```



# 3、创建一个大小为1G的swap分区，并启用

**步骤1：创建一个1G的swap分区：`/dev/sda6`**

> ```
> [root@localhost ~]# fdisk /dev/sda
> 
> WARNING: DOS-compatible mode is deprecated. It's strongly recommended to
>          switch off the mode (command 'c') and change display units to
>          sectors (command 'u').
> 
> Command (m for help): p
> 
> Disk /dev/sda: 128.8 GB, 128849018880 bytes
> 255 heads, 63 sectors/track, 15665 cylinders
> Units = cylinders of 16065 * 512 = 8225280 bytes
> Sector size (logical/physical): 512 bytes / 512 bytes
> I/O size (minimum/optimal): 512 bytes / 512 bytes
> Disk identifier: 0x0006b0aa
> 
>    Device Boot      Start         End      Blocks   Id  System
> /dev/sda1   *           1        7650    61440000   83  Linux
> /dev/sda2            7650        7905     2048000   82  Linux swap / Solaris
> /dev/sda3            7905        9210    10490301   83  Linux
> /dev/sda4            9211       15665    51849787+   5  Extended
> /dev/sda5            9211       10516    10490413+  83  Linux
> 
> Command (m for help): n
> First cylinder (10517-15665, default 10517): 
> Using default value 10517
> Last cylinder, +cylinders or +size{K,M,G} (10517-15665, default 15665): +1G
> 
> Command (m for help): p
> 
> Disk /dev/sda: 128.8 GB, 128849018880 bytes
> 255 heads, 63 sectors/track, 15665 cylinders
> Units = cylinders of 16065 * 512 = 8225280 bytes
> Sector size (logical/physical): 512 bytes / 512 bytes
> I/O size (minimum/optimal): 512 bytes / 512 bytes
> Disk identifier: 0x0006b0aa
> 
>    Device Boot      Start         End      Blocks   Id  System
> /dev/sda1   *           1        7650    61440000   83  Linux
> /dev/sda2            7650        7905     2048000   82  Linux swap / Solaris
> /dev/sda3            7905        9210    10490301   83  Linux
> /dev/sda4            9211       15665    51849787+   5  Extended
> /dev/sda5            9211       10516    10490413+  83  Linux
> /dev/sda6           10517       10648     1060258+  83  Linux
> 
> Command (m for help): t
> Partition number (1-6): 6
> Hex code (type L to list codes): 82
> Changed system type of partition 6 to 82 (Linux swap / Solaris)
> 
> Command (m for help): p
> 
> Disk /dev/sda: 128.8 GB, 128849018880 bytes
> 255 heads, 63 sectors/track, 15665 cylinders
> Units = cylinders of 16065 * 512 = 8225280 bytes
> Sector size (logical/physical): 512 bytes / 512 bytes
> I/O size (minimum/optimal): 512 bytes / 512 bytes
> Disk identifier: 0x0006b0aa
> 
>    Device Boot      Start         End      Blocks   Id  System
> /dev/sda1   *           1        7650    61440000   83  Linux
> /dev/sda2            7650        7905     2048000   82  Linux swap / Solaris
> /dev/sda3            7905        9210    10490301   83  Linux
> /dev/sda4            9211       15665    51849787+   5  Extended
> /dev/sda5            9211       10516    10490413+  83  Linux
> /dev/sda6           10517       10648     1060258+  82  Linux swap / Solaris
> 
> Command (m for help): w
> The partition table has been altered!
> 
> Calling ioctl() to re-read partition table.
> 
> WARNING: Re-reading the partition table failed with error 16: Device or resource busy.
> The kernel still uses the old table. The new table will be used at
> the next reboot or after you run partprobe(8) or kpartx(8)
> Syncing disks.
> [root@localhost ~]# partx -a /dev/sda
> BLKPG: Device or resource busy
> error adding partition 1
> BLKPG: Device or resource busy
> error adding partition 2
> BLKPG: Device or resource busy
> error adding partition 3
> BLKPG: Device or resource busy
> error adding partition 4
> BLKPG: Device or resource busy
> error adding partition 5
> [root@localhost ~]# partx -a /dev/sda
> BLKPG: Device or resource busy
> error adding partition 1
> BLKPG: Device or resource busy
> error adding partition 2
> BLKPG: Device or resource busy
> error adding partition 3
> BLKPG: Device or resource busy
> error adding partition 4
> BLKPG: Device or resource busy
> error adding partition 5
> BLKPG: Device or resource busy
> error adding partition 6
> [root@localhost ~]# cat /proc/partitions 
> major minor  #blocks  name
> 
>    8        0  125829120 sda
>    8        1   61440000 sda1
>    8        2    2048000 sda2
>    8        3   10490301 sda3
>    8        4         31 sda4
>    8        5   10490413 sda5
>    8        6    1060258 sda6
> [root@localhost ~]# 
> ```

**步骤2：格式化：**

```
[root@localhost ~]# mkswap /dev/sda6
```

> ```
> [root@localhost ~]# mkswap /dev/sda6
> Setting up swapspace version 1, size = 1060252 KiB
> no label, UUID=9e8f12cb-a20f-4a9c-8209-35c381a2194b
> [root@localhost ~]# 
> ```

**步骤3：启用：**

```
[root@localhost ~]# swapon /dev/sda6
```

> ```
> [root@localhost ~]# free -m
>              total       used       free     shared    buffers     cached
> Mem:           979        397        582          0         57        195
> -/+ buffers/cache:        143        835
> Swap:         1999          0       1999
> [root@localhost ~]# swapon /dev/sda6
> [root@localhost ~]# free -m
>              total       used       free     shared    buffers     cached
> Mem:           979        397        581          0         57        195
> -/+ buffers/cache:        144        835
> Swap:         3035          0       3035
> [root@localhost ~]# 
> ```



# 4、编写脚本计算/etc/passwd文件中第10个用户和第20个用户id号之和

```
#!/bin/bash
# Version: 0.0.1
# Author: Paul
# Description: The sum of the 10th user and the 20th user id number

id1=$(head -10 /etc/passwd | tail -1 | cut -d: -f3)
echo "the 10th user id number : $id1 "

id2=$(head -20 /etc/passwd | tail -1 | cut -d: -f3)
echo "the 20th user id number : $id2 "

echo
id_sum=$[$id1+$id2]
echo "the user_id_sum is : $id_sum"
```

> ```
> [root@localhost ~]# vim user_id_sum.sh
> #!/bin/bash
> # Version: 0.0.1
> # Author: Paul
> # Description: The sum of the 10th user and the 20th user id number
> 
> id1=$(head -10 /etc/passwd | tail -1 | cut -d: -f3)
> echo "the 10th user id number : $id1 "
> 
> id2=$(head -20 /etc/passwd | tail -1 | cut -d: -f3)
> echo "the 20th user id number : $id2 "
> 
> echo
> id_sum=$[$id1+$id2]
> echo "the user_id_sum is : $id_sum"
> [root@localhost ~]# bash user_id_sum.sh 
> the 10th user id number : 10 
> the 20th user id number : 68 
> 
> the user_id_sum is : 78
> [root@localhost ~]# head -10 /etc/passwd | tail -1
> uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin
> [root@localhost ~]# head -20 /etc/passwd | tail -1
> haldaemon:x:68:68:HAL daemon:/:/sbin/nologin
> [root@localhost ~]# 
> ```



# 5、将当前主机名保存至hostName变量中，主机名如果为空，或者为localhost.localdomain则将设置为www.magedu.com

```
#!/bin/bash
# Version: 0.0.1
# Author: Paul
# Description: hostname testing

hostName=$(hostname)

if [ -z "$hostName" -o "$hostName" == "localhost.localdomain" ]; then
	hostname www.magedu.com
	host_name=$(hostname)
	echo "The host_name has changed to : $host_name "
else
	echo "The host_name is : $hostName "
fi	
```

> ```
> [root@localhost ~]# vim host_test.sh 
> #!/bin/bash
> # Version: 0.0.1
> # Author: Paul
> # Description: hostname testing
> 
> hostName=$(hostname)
> 
> if [ -z "$hostName" -o "$hostName" == "localhost.localdomain" ]; then
>         hostname www.magedu.com
>         host_name=$(hostname)
>         echo "The host_name has changed to : $host_name "
> else
>         echo "The host_name is : $hostName "
> fi
> [root@localhost ~]# bash host_test.sh 
> The host_name has changed to : www.magedu.com 
> [root@localhost ~]# 
> ```



# 6、编写脚本，通过命令行参数传入一个用户名，判断id号是偶数还是奇数

```
#!/bin/bash
# Version: 0.0.1
# Author: Paul
# Description: the id number is even or odd

if [ $# -lt 1 ]; then
        echo "At least one username."
        exit 2
fi


if ! grep "^$1\>" /etc/passwd &> /dev/null; then
        useradd $1
        id_number=$(grep "^$1\>" /etc/passwd | cut -d: -f3)
else
        id_number=$(grep "^$1\>" /etc/passwd | cut -d: -f3)
fi

echo "the user_name is : "
echo "$(id $1)"
echo

if [ $[$id_number%2] -eq 0 ]; then
        echo "user_name_id: $id_number  is even. "
else
        echo "user_name_id: $id_number  is odd. "
fi
```

> ```
> [root@localhost ~]# vim id_number_test.sh
> #!/bin/bash
> # Version: 0.0.1
> # Author: Paul
> # Description: the id number is even or odd
> 
> if [ $# -lt 1 ]; then
>         echo "At least one username."
>         exit 2
> fi
> 
> 
> if ! grep "^$1\>" /etc/passwd &> /dev/null; then
>         useradd $1
>         id_number=$(grep "^$1\>" /etc/passwd | cut -d: -f3)
> else
>         id_number=$(grep "^$1\>" /etc/passwd | cut -d: -f3)
> fi
> 
> echo "the user_name is : "
> echo "$(id $1)"
> echo
> 
> if [ $[$id_number%2] -eq 0 ]; then
>         echo "user_name_id: $id_number  is even. "
> else
>         echo "user_name_id: $id_number  is odd. "
> fi
> [root@localhost ~]# chmod +x id_number_test.sh 
> [root@localhost ~]# ./id_number_test.sh 
> At least one username.
> [root@localhost ~]# echo $?
> 2
> [root@localhost ~]#
> [root@localhost ~]# id archlinux
> uid=1000(archlinux) gid=1000(archlinux) groups=1000(archlinux)
> [root@localhost ~]# ./id_number_test.sh archlinux
> the user_name is : 
> uid=1000(archlinux) gid=1000(archlinux) groups=1000(archlinux)
> 
> user_name_id: 1000  is even. 
> [root@localhost ~]#
> [root@localhost ~]# id suse
> id: suse: No such user
> [root@localhost ~]# ./id_number_test.sh suse
> the user_name is : 
> uid=1003(suse) gid=1003(suse) groups=1003(suse)
> 
> user_name_id: 1003  is odd.
> [root@localhost ~]#
> ```



# 7、lvm基本应用以及扩展缩减实现

### 基本概念：

> LVM：Logical Volume Manager，使用的是内核中的dm模块；
>
> ​	dm：device mapper, 将一个或多个底层块设备组织成一个逻辑设备的模块；